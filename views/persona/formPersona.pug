include ..\includes\layout
block content
html(lang="es")
  head
    meta(charset="UTF-8")
    meta(name="viewport", content="width=device-width, initial-scale=1, shrink-to-fit=no")
    title Alta de Persona
    // Agrega la referencia a Bootstrap CSS
    link(rel="stylesheet", href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css")
    style.
      #formPersona {
        max-width: 600px;
        margin: auto;
      }

      h2 {
            text-align: center;
            text-decoration: underline;
            text-underline-offset: 4px; /* Ajusta el espacio entre el texto y el subrayado */
            margin-top: 10px;
        }

      label {
        margin-bottom: 5px;
      }

      #matriculaLabel, #matricula, #matriculaDiv {
        display: none;
      }
  body
    #formPersona
      h2.text-center Ingresar una Persona
      // Agregar lógica para mostrar mensajes flash aquí
      if messages.error
        .alert.alert-danger
          = messages.error
      form(action="/personas", method="post" onsubmit="return validarFormulario()")
        .form-group
          label(for="dni") DNI:
          input(type="text" class="form-control" id="dni" name="DNI" required title="Debe contener exactamente 7 u 8 números")
        .form-group
          label(for="nombre") Nombre:
          input(type="text" class="form-control" id="nombre" name="nombre" required)
        .form-group
          label(for="apellido") Apellido:
          input(type="text" class="form-control" id="apellido" name="apellido" required)
        .form-group
          label(for="email") Email:
          input(type="email" class="form-control" id="email" name="email" required)
        .form-group
          label(for="fechaDeNacimiento") Fecha de Nacimiento:
          input(type="date" class="form-control" id="fechaDeNacimiento" name="fechaDeNacimiento" required)
        .form-group
          label(for="ocupacion") Ocupación:
          select(class="form-control" name="ocupacion" id="ocupacion" onchange="seleccionarOcupacion()" required)
            option(disabled selected hidden) Selecciona una Ocupacion:
            option(value="agente de salud") Agente de Salud
            option(value="otro") Otro
        .form-group#matriculaDiv
          label(for="matricula" id="matriculaLabel" style="display: none;") Matrícula:
          input(type="number" class="form-control" id="matricula" name="matricula" style="display: none;")
        .form-group
          label(for="genero") Género:
          select(class="form-control" name="genero" required)
            option(value="Masculino") Masculino
            option(value="Femenino") Femenino
            option(value="Otro") Otro
        .form-group
          label(for="celular1") Celular 1:
          input(type="tel" class="form-control" id="celular1" name="celular1" title="Debe contener un máximo de 10 digitos")
        .form-group
          label(for="celular2") Celular 2:
          input(type="tel" class="form-control" id="celular2" name="celular2" title="Debe contener un máximo de 10 digitos")
        .form-group
          label(for="patologiaBase") Patologia Base:
          input(type="text" class="form-control" id="patologiaBase" name="patologiaBase")
        .form-group
          label(for="longitud") Longitud:
          input(type="text" class="form-control" id="longitud" name="longitud" required)
        .form-group
          label(for="latitud") Latitud:
          input(type="text" class="form-control" id="latitud" name="latitud" required)
        button(type="submit" class="btn btn-primary") Guardar

  // Agrega la referencia a Bootstrap JS (opcional, solo si lo necesitas)
  script(src="https://code.jquery.com/jquery-3.2.1.slim.min.js")
  script(src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js")
  script(src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js")

  script.
    function seleccionarOcupacion() {
      var rolSelect = document.getElementById("ocupacion");
      var matriculaLabel = document.getElementById("matriculaLabel");
      var matriculaInput = document.getElementById("matricula");
      var matriculaDiv = document.getElementById("matriculaDiv");
      if (rolSelect.value === "agente de salud") {
        matriculaLabel.style.display = "block";
        matriculaInput.style.display = "block";
        matriculaDiv.style.display = "block";
      } else {
        matriculaLabel.style.display = "none";
        matriculaInput.style.display = "none";
        matriculaDiv.style.display = "none";
      }
    }

    function validarFormulario() {
      // Validación Nombre y Apellido
      /*var nombreInput = document.getElementById("nombre");
      var apellidoInput = document.getElementById("apellido");
      var namePattern = /^[A-Za-záéíóúüñÁÉÍÓÚÜÑ\s]{1,30}$/;
      if (!namePattern.test(nombreInput.value) || !namePattern.test(apellidoInput.value)) {
        alert("Nombre y Apellido deben contener solo letras hasta 30 caracteres.");
        return false;
      }

      // Validación Email
      var emailInput = document.getElementById("email");
      var emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
      if (!emailPattern.test(emailInput.value)) {
        alert("Ingrese un email válido.");
        return false;
      }

      // Validación Fecha
      var fechaInput = document.getElementById("fechaDeNacimiento");
      var currentDate = new Date().toISOString().split("T")[0];
      if (fechaInput.value > currentDate) {
        alert("La fecha de nacimiento no puede ser posterior a la actual.");
        return false;
      }

      // Validación Celulares
      var celular1Input = document.getElementById("celular1");
      var celular2Input = document.getElementById("celular2");
      var phonePattern = /^[0-9]{10}$/;
      if (!phonePattern.test(celular1Input.value) || !phonePattern.test(celular2Input.value)) {
        alert("Los números de celular deben contener solo números y tener 10 dígitos.");
        return false;
      }

      // Validación Longitud y Latitud
      var longitudInput = document.getElementById("longitud");
      var latitudInput = document.getElementById("latitud");
      var longitudPattern = /^(-?((180\.0{0,6})|(((\d|[1-9]\d|1[0-7]\d)(\.\d{0,6})?)|180)))$/;
      var latitudPattern = /^(-?([1-8]?\d(\.\d{0,6})?|90(\.0{0,6})?))$/;
      if (!longitudPattern.test(longitudInput.value) || !latitudPattern.test(latitudInput.value)) {
        alert("Ingrese valores válidos para Longitud y Latitud.");
        return false;
      }*/

      //return true;
    }

    $(function (){
      $('#dni').on('focusout', ()=> {
        var dniPattern = /^[0-9]{7,8}$/;
        if (!dniPattern.test($('#dni').val())) {
          $('#dni').removeClass('is-valid')
          $('#dni').addClass('is-invalid')
        } else {
          $('#dni').removeClass('is-invalid')
          $('#dni').addClass('is-valid')
        }
      })
      $('#email').on('focusout', ()=> {
        var emailPattern = /^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$/;
        if(!emailPattern.test($('#email').val())) {
          $('#email').removeClass('is-valid')
          $('#email').addClass('is-invalid')
        } else {
          $('#email').removeClass('is-invalid')
          $('#email').addClass('is-valid')
        }
      })
      $('#celular1').on('focusout', ()=> {
        var phonePattern = /^[0-9]{10}$/;
        if (!phonePattern.test($('#celular1').val())) {
          $('#celular1').removeClass('is-valid')
          $('#celular1').addClass('is-invalid')
        } else {
          $('#celular1').removeClass('is-invalid')
          $('#celular1').addClass('is-valid')
        }
      })
      $('#celular2').on('focusout', ()=> {
        var phonePattern = /^[0-9]{10}$/;
        if (!phonePattern.test($('#celular2').val())) {
          $('#celular2').removeClass('is-valid')
          $('#celular2').addClass('is-invalid')
        } else {
          $('#celular2').removeClass('is-invalid')
          $('#celular2').addClass('is-valid')
        }
      })
      $('#longitud').on('focusout', ()=> {
        var longitudPattern = /^(-?((180\.0{0,6})|(((\d|[1-9]\d|1[0-7]\d)(\.\d{0,6})?)|180)))$/;
        if (!longitudPattern.test($('#longitud').val())) {
          $('#longitud').removeClass('is-valid')
          $('#longitud').addClass('is-invalid')
        } else {
          $('#longitud').removeClass('is-invalid')
          $('#longitud').addClass('is-valid')
        }
      })
      $('#latitud').on('focusout', ()=> {
        var latitudPattern = /^(-?([1-8]?\d(\.\d{0,6})?|90(\.0{0,6})?))$/;
        if (!latitudPattern.test($('#latitud').val())) {
          $('#latitud').removeClass('is-valid')
          $('#latitud').addClass('is-invalid')
        } else {
          $('#latitud').removeClass('is-invalid')
          $('#latitud').addClass('is-valid')
        }
      })
      $('#fechaNacimiento').on('focusout', ()=> {
        // Obtén la fecha del elemento con id "fechaDeNacimiento"
        const fechaNacimiento = $('#fechaDeNacimiento').val();
        // Crea un objeto Date con la fecha de nacimiento
        const date = new Date(fechaNacimiento);
        // Obtiene el año
        const year = date.getFullYear();
        console.log(fechaNacimiento); // Esto imprimirá el año en la consola
        if (!datePattern.test($('#fechaNacimiento').val())) {
          $('#fechaNacimiento').removeClass('is-valid')
          $('#fechaNacimiento').addClass('is-invalid')
        } else {
          $('#fechaNacimiento').removeClass('is-invalid')
          $('#fechaNacimiento').addClass('is-valid')
        }
      })
    })